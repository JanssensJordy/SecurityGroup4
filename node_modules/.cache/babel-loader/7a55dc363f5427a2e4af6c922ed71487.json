{"remainingRequest":"C:\\Users\\janss\\Desktop\\BeveiligingsOpdracht\\Client_v2\\node_modules\\babel-loader\\lib\\index.js!C:\\Users\\janss\\Desktop\\BeveiligingsOpdracht\\Client_v2\\node_modules\\eslint-loader\\index.js??ref--13-0!C:\\Users\\janss\\Desktop\\BeveiligingsOpdracht\\Client_v2\\src\\auth\\authService.js","dependencies":[{"path":"C:\\Users\\janss\\Desktop\\BeveiligingsOpdracht\\Client_v2\\src\\auth\\authService.js","mtime":1552498198803},{"path":"C:\\Users\\janss\\Desktop\\BeveiligingsOpdracht\\Client_v2\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\janss\\Desktop\\BeveiligingsOpdracht\\Client_v2\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\janss\\Desktop\\BeveiligingsOpdracht\\Client_v2\\node_modules\\eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["import _Date$now from \"C:\\\\Users\\\\janss\\\\Desktop\\\\BeveiligingsOpdracht\\\\Client_v2\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/date/now\";\nimport _Promise from \"C:\\\\Users\\\\janss\\\\Desktop\\\\BeveiligingsOpdracht\\\\Client_v2\\\\node_modules\\\\@babel\\\\runtime-corejs2/core-js/promise\";\nimport _classCallCheck from \"C:\\\\Users\\\\janss\\\\Desktop\\\\BeveiligingsOpdracht\\\\Client_v2\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"C:\\\\Users\\\\janss\\\\Desktop\\\\BeveiligingsOpdracht\\\\Client_v2\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"C:\\\\Users\\\\janss\\\\Desktop\\\\BeveiligingsOpdracht\\\\Client_v2\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"C:\\\\Users\\\\janss\\\\Desktop\\\\BeveiligingsOpdracht\\\\Client_v2\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"C:\\\\Users\\\\janss\\\\Desktop\\\\BeveiligingsOpdracht\\\\Client_v2\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/inherits\";\nimport _assertThisInitialized from \"C:\\\\Users\\\\janss\\\\Desktop\\\\BeveiligingsOpdracht\\\\Client_v2\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/assertThisInitialized\";\nimport _defineProperty from \"C:\\\\Users\\\\janss\\\\Desktop\\\\BeveiligingsOpdracht\\\\Client_v2\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\nimport auth0 from \"auth0-js\";\nimport { EventEmitter } from \"events\";\nimport authConfig from \"../../auth_config.json\";\nvar webAuth = new auth0.WebAuth({\n  domain: authConfig.domain,\n  redirectUri: \"\".concat(window.location.origin, \"/callback\"),\n  clientID: authConfig.clientId,\n  responseType: \"token id_token\",\n  scope: \"rudy.read openid profile email\",\n  audience: \"naamapi\"\n});\nvar localStorageKey = \"loggedIn\";\nvar loginEvent = \"loginEvent\";\n\nvar AuthService =\n/*#__PURE__*/\nfunction (_EventEmitter) {\n  _inherits(AuthService, _EventEmitter);\n\n  function AuthService() {\n    var _getPrototypeOf2;\n\n    var _this;\n\n    _classCallCheck(this, AuthService);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    _this = _possibleConstructorReturn(this, (_getPrototypeOf2 = _getPrototypeOf(AuthService)).call.apply(_getPrototypeOf2, [this].concat(args)));\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"idToken\", null);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"profile\", null);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"accessToken\", null);\n\n    _defineProperty(_assertThisInitialized(_assertThisInitialized(_this)), \"tokenExpiry\", null);\n\n    return _this;\n  }\n\n  _createClass(AuthService, [{\n    key: \"login\",\n    value: function login(customState) {\n      webAuth.authorize({\n        appState: customState\n      });\n    }\n  }, {\n    key: \"logOut\",\n    value: function logOut() {\n      localStorage.removeItem(localStorageKey);\n      this.idToken = null;\n      this.tokenExpiry = null;\n      this.profile = null;\n      this.accessToken = null;\n      webAuth.logout({\n        returnTo: \"\".concat(window.location.origin)\n      });\n      this.emit(loginEvent, {\n        loggedIn: false\n      });\n    }\n  }, {\n    key: \"handleAuthentication\",\n    value: function handleAuthentication() {\n      var _this2 = this;\n\n      return new _Promise(function (resolve, reject) {\n        webAuth.parseHash(function (err, authResult) {\n          if (err) {\n            reject(err);\n          } else {\n            _this2.localLogin(authResult);\n\n            console.log(authResult.accessToken);\n            resolve(authResult.idToken);\n            resolve(authResult.accessToken);\n          }\n        });\n      });\n    }\n  }, {\n    key: \"isAuthenticated\",\n    value: function isAuthenticated() {\n      return _Date$now() < this.tokenExpiry && localStorage.getItem(localStorageKey) === \"true\";\n    }\n  }, {\n    key: \"isIdTokenValid\",\n    value: function isIdTokenValid() {\n      return this.idToken && this.tokenExpiry && _Date$now() < this.tokenExpiry;\n    }\n  }, {\n    key: \"getIdToken\",\n    value: function getIdToken() {\n      var _this3 = this;\n\n      return new _Promise(function (resolve, reject) {\n        if (_this3.isIdTokenValid()) {\n          resolve(_this3.idToken);\n          resolve(_this3.accessToken);\n        } else if (_this3.isAuthenticated()) {\n          _this3.renewTokens().then(function (authResult) {\n            resolve(authResult.idToken);\n            resolve(authResult.accessToken);\n          }, reject);\n        } else {\n          resolve();\n        }\n      });\n    }\n  }, {\n    key: \"getAccessToken\",\n    value: function getAccessToken() {\n      return this.accessToken;\n    }\n  }, {\n    key: \"localLogin\",\n    value: function localLogin(authResult) {\n      this.idToken = authResult.idToken;\n      this.profile = authResult.idTokenPayload;\n      this.accessToken = authResult.accesToken;\n      console.log(authResult.accessToken); // Convert the expiry time from seconds to milliseconds,\n      // required by the Date constructor\n\n      this.tokenExpiry = new Date(this.profile.exp * 1000);\n      localStorage.setItem(localStorageKey, \"true\");\n      this.emit(loginEvent, {\n        loggedIn: true,\n        profile: authResult.idTokenPayload,\n        state: authResult.appState || {}\n      });\n    }\n  }, {\n    key: \"renewTokens\",\n    value: function renewTokens() {\n      var _this4 = this;\n\n      return new _Promise(function (resolve, reject) {\n        if (localStorage.getItem(localStorageKey) !== \"true\") {\n          return reject(\"Not logged in\");\n        }\n\n        webAuth.checkSession({}, function (err, authResult) {\n          if (err) {\n            reject(err);\n          } else {\n            _this4.localLogin(authResult);\n\n            resolve(authResult);\n          }\n        });\n      });\n    }\n  }]);\n\n  return AuthService;\n}(EventEmitter);\n\nvar service = new AuthService();\nservice.setMaxListeners(5);\nexport default service;",{"version":3,"sources":["C:\\Users\\janss\\Desktop\\BeveiligingsOpdracht\\Client_v2\\src\\auth\\authService.js"],"names":["auth0","EventEmitter","authConfig","webAuth","WebAuth","domain","redirectUri","window","location","origin","clientID","clientId","responseType","scope","audience","localStorageKey","loginEvent","AuthService","customState","authorize","appState","localStorage","removeItem","idToken","tokenExpiry","profile","accessToken","logout","returnTo","emit","loggedIn","resolve","reject","parseHash","err","authResult","localLogin","console","log","getItem","isIdTokenValid","isAuthenticated","renewTokens","then","idTokenPayload","accesToken","Date","exp","setItem","state","checkSession","service","setMaxListeners"],"mappings":"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","sourcesContent":["import auth0 from \"auth0-js\";\nimport { EventEmitter } from \"events\";\nimport authConfig from \"../../auth_config.json\";\n\nconst webAuth = new auth0.WebAuth({\n  domain: authConfig.domain,\n  redirectUri: `${window.location.origin}/callback`,\n  clientID: authConfig.clientId,\n  responseType: \"token id_token\",\n  scope: \"rudy.read openid profile email\",\n  audience: \"naamapi\"\n});\n\nconst localStorageKey = \"loggedIn\";\nconst loginEvent = \"loginEvent\";\n\nclass AuthService extends EventEmitter {\n  idToken = null;\n  profile = null;\n  accessToken = null;\n  tokenExpiry = null;\n\n  login(customState) {\n    webAuth.authorize({\n      appState: customState\n    });\n  }\n\n  logOut() {\n    localStorage.removeItem(localStorageKey);\n\n    this.idToken = null;\n    this.tokenExpiry = null;\n    this.profile = null;\n    this.accessToken = null;\n    \n\n    webAuth.logout({\n      returnTo: `${window.location.origin}`\n    });\n\n    this.emit(loginEvent, { loggedIn: false });\n  }\n\n  handleAuthentication() {\n    return new Promise((resolve, reject) => {\n      webAuth.parseHash((err, authResult) => {\n        if (err) {\n          reject(err);\n        } else {\n          this.localLogin(authResult);\n          console.log(authResult.accessToken)\n          resolve(authResult.idToken);\n          resolve(authResult.accessToken);\n        }\n      });\n    });\n  }\n\n  isAuthenticated() {\n    return (\n      Date.now() < this.tokenExpiry &&\n      localStorage.getItem(localStorageKey) === \"true\"\n    );\n  }\n\n  isIdTokenValid() {\n    return (\n      this.idToken &&\n      this.tokenExpiry &&\n      Date.now() < this.tokenExpiry\n    );\n  }\n\n  getIdToken() {\n    return new Promise((resolve, reject) => {\n      if (this.isIdTokenValid()) {\n        resolve(this.idToken);\n        resolve(this.accessToken);\n      } else if (this.isAuthenticated()) {\n        this.renewTokens().then(authResult => {\n          resolve(authResult.idToken);\n          resolve(authResult.accessToken);\n        }, reject);\n      } else {\n        resolve();\n      }\n    });\n  }\n\n  getAccessToken() {\n    return this.accessToken;\n  }\n\n  localLogin(authResult) {\n    this.idToken = authResult.idToken;\n    this.profile = authResult.idTokenPayload;\n    this.accessToken = authResult.accesToken;\n    console.log(authResult.accessToken)\n    // Convert the expiry time from seconds to milliseconds,\n    // required by the Date constructor\n    this.tokenExpiry = new Date(this.profile.exp * 1000);\n\n    localStorage.setItem(localStorageKey, \"true\");\n    this.emit(loginEvent, {\n      loggedIn: true,\n      profile: authResult.idTokenPayload,\n      state: authResult.appState || {}\n    });\n  }\n\n  renewTokens() {\n    return new Promise((resolve, reject) => {\n      if (localStorage.getItem(localStorageKey) !== \"true\") {\n        return reject(\"Not logged in\");\n      }\n\n      webAuth.checkSession({}, (err, authResult) => {\n        if (err) {\n          reject(err);\n        } else {\n          this.localLogin(authResult);\n          resolve(authResult);\n        }\n      });\n    });\n  }\n}\n\nconst service = new AuthService();\n\nservice.setMaxListeners(5);\n\nexport default service;\n"]}]}